#
# 1) DISTRO 機能セット
#
DISTRO_FEATURES:append = " systemd virtualization overlayfs cgroup"

# sysvinit を back-fill させない（systemd 専用にする）
DISTRO_FEATURES_BACKFILL_CONSIDERED += "sysvinit"

#
# 2) init manager を systemd に固定
#
VIRTUAL-RUNTIME_init_manager   = "systemd"
VIRTUAL-RUNTIME_initscripts    = "systemd-compat-units"

#
# 3) 追加ユーザ／グループ
#
INHERIT += "extrausers"

# Generating password hashes with openssl 
# command: openssl passwd -6 mypassword
#fuji1pd
FUJI_PASSWORD = "\$6\$R1zu78cNYcbEU0kT\$9Uy8vw.ezGnXXX7HVLArBVZLBjuRvJrLEXvH3mQ9pd.RjvzjV9rxi38Oa2VnTA.R5U2/etEVJs1/x00X/K4UO1" 
#admin
ROOT_PASSWORD = "\$6\$hLhODdfMOWDVBWih\$d5G8iLxbhGBzpHWSG3.ejM.GmMBRntoaNo7Rt0xfn7To0k5t6gT8WbcAX/eFkFYjHycDCmwUtWc5iXYjsesyk0" 


EXTRA_USERS_PARAMS = "\
    usermod -p '${ROOT_PASSWORD}' root; \
    groupadd -r docker; \
"

#
# 4) 追加パッケージ
#
IMAGE_INSTALL:append = " \
    dpkg \
    docker-ce \
    python3-docker-compose \
    systemd-networkd-wait-online-config \
    openssh \
    udev-rules-fuji \
    kernel-modules \
    systemd-analyze \ 
    joystick\
"
#
# 5) 不要パッケージを除外
#
PACKAGE_EXCLUDE               = "desktop-file-utils"
IMAGE_INSTALL:remove          = "vim"

#
# 6) hid-playstation モジュールの provider を自作レシピに固定
#
PREFERRED_PROVIDER_kernel-module-hid-playstation = "linux-hid-playstation"

#　後で消すを
IMAGE_INSTALL:append = " systemd-analyze"


