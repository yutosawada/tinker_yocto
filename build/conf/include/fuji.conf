#add systemd to the distro features
DISTRO_FEATURES:append = " systemd"
DISTRO_FEATURES_BACKFILL_CONSIDERED += "sysvinit"

#add docker to the image
DISTRO_FEATURES:append = " virtualization"

VIRTUAL-RUNTIME_init_manager = "systemd"
VIRTUAL-RUNTIME_initscripts = "systemd-compat-units"
# overlayfs, cgroup を有効化
DISTRO_FEATURES:append = " overlayfs cgroup"


#add user and passwords
INHERIT += "extrausers"

# Generating password hashes with openssl 
# command: openssl passwd -6 mypassword
#fuji1pd
FUJI_PASSWORD = "\$6\$R1zu78cNYcbEU0kT\$9Uy8vw.ezGnXXX7HVLArBVZLBjuRvJrLEXvH3mQ9pd.RjvzjV9rxi38Oa2VnTA.R5U2/etEVJs1/x00X/K4UO1" 
#admin
ROOT_PASSWORD = "\$6\$hLhODdfMOWDVBWih\$d5G8iLxbhGBzpHWSG3.ejM.GmMBRntoaNo7Rt0xfn7To0k5t6gT8WbcAX/eFkFYjHycDCmwUtWc5iXYjsesyk0" 


EXTRA_USERS_PARAMS = "\
    usermod -p '${ROOT_PASSWORD}' root; \
    groupadd -r docker; \
"
# useradd -P '{$FUJI_PASSWORD}' -u 1001 -U -G sudo -d /home/fuji -s /bin/bash fuji; 
# useradd -p '${FUJI_PASSWORD}' -u 1001 -U -aG docker -d /home/fuji -s /bin/bash fuji;

#add dpkg to the image
IMAGE_INSTALL:append = " dpkg"

#add docker to the image
IMAGE_INSTALL:append = " docker-ce" 
IMAGE_INSTALL:append = " python3-docker-compose"

#docker 起動に120秒かかるので、systemd-networkd-wait-online のタイムアウトを短縮する設定ファイルを追加
IMAGE_INSTALL:append = " systemd-networkd-wait-online-config"

#add openssh-server to the image
IMAGE_INSTALL:append = " openssh"

#add CAN device renaming udev rules to the image
IMAGE_INSTALL:append = " udev-rules-fuji"


# Remove unnecessary applications
PACKAGE_EXCLUDE = "desktop-file-utils"
IMAGE_INSTALL:remove = " vim"



#　後で消すを
IMAGE_INSTALL:append = " systemd-analyze"


